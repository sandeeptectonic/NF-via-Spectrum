{% comment %}theme-check-disable NestedSnippet{% endcomment %}
<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}">
  <head>{% render 'skio-head' %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0"
    >
    <meta name="theme-color" content="{{ settings.color_brand }}">

    {% comment %} Tectonic custom code starts {% endcomment %}

    {{ 'tt_heimdall.js' | asset_url | script_tag }}
    
    <script type="text/javascript">
        console.debug("Testing update");
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "ritrzfbzx8");
    </script>
    
    {% comment %} Tectonic custom code ends {% endcomment %}

    <!-- BEGIN MerchantWidget Code -->
<script id='merchantWidgetScript'
        src="https://www.gstatic.com/shopping/merchant/merchantwidget.js"
        defer>
</script>
<script type="text/javascript">
  merchantWidgetScript.addEventListener('load', function () {
    merchantwidget.start({
      position: 'LEFT_BOTTOM',
      sideMargin: 21,
      bottomMargin: 40,
      mobileSideMargin: 11,
      mobileBottomMargin: 19
   });
  });
</script>
<!-- END MerchantWidget Code -->

<!-- 14.ai Chat Widget + Secure Identity Verification -->
    <script src="https://embed.14.ai/s/COIuY89DKU6nK6Jb"></script>

    <script>
      // Wait for the 14.ai widget to be fully ready
      window.fourteen.onReady(() => {
        configureFourteenUser();
      })

      function configureFourteenUser() {
        // Logged-in customer â€“ use secure encrypted payload (recommended)
        {% if customer %}
          const userPayload = {
            email: {{ customer.email | json }},
            name: {{ customer.name | json }},
            {% if customer.first_name %}
            firstName: {{ customer.first_name | json }},
            {% endif %}
            {% if customer.last_name %}
            lastName: {{ customer.last_name | json }},
            {% endif %}
            shopifyId: {{ customer.id | json | prepend: '"' | append: '"' }},
            metadata: {
              shopify_customer_id: {{ customer.id | json }},
              shopify_tags: {{ customer.tags | join: ', ' | json }},
              total_spent: "{{ customer.total_spent }}",
              orders_count: {{ customer.orders_count | json }}
            }
            // Add any auth tokens you need here if you use MCP tools
          };
          
          window.fourteen.setUser(userPayload);
        {% endif %}

        if (window.Shopify && Shopify.designMode === false) {
          document.addEventListener('shopify:customer:logout', () => {
            window.fourteen.logout?.();
          });
        }
      }
    </script>

    <!-- Google Tag Manager -->
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-NFF2NMMS');
    </script>
    <!-- End Google Tag Manager -->

    <!-- BING Code -->
    <script>
      (function(w,d,t,r,u)
      {
          var f,n,i;
          w[u]=w[u]||[],f=function()
          {
              var o={ti:"26347740", enableAutoSpaTracking: true};
              o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")
          },
          n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function()
          {
              var s=this.readyState;
              s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)
          },
          i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)
      })
      (window,document,"script","//bat.bing.com/bat.js","uetq");
    </script>
    <!-- End BING -->
    {% if handle contains 'axe-sledge-bogo40-sale' %}
      <meta name="robots" content="noindex">
    {% endif %}

    {% if handle contains 'test-home-page' %}
      <meta name="robots" content="noindex">
    {% endif %}

    {% if handle contains 'summer-shred-sale' %}
      <meta name="robots" content="noindex">
    {% endif %}

    {% render 'network' %}

    {%- if canonical_url != blank -%}
      <link rel="canonical" href="{{ canonical_url }}">
    {%- endif -%}

    {% if settings.favicon != blank %}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 32, height: 32 }}" type="image/png">
    {% endif %}

    <!-- Title and description ================================================== -->
    <title>{% render 'seo-title' %}</title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    {% render 'social-meta-tags' %}

    <!-- JS before CSSOM =================================================== -->
    <script type="text/javascript">
      theme = {};
      theme.t = {};
       	theme.t.add_to_cart = '{{ 'products.product.add_to_cart' | t }}';
         theme.t.sold_out = '{{ 'products.product.sold_out' | t }}';
         theme.t.unavailable = '{{ 'products.product.unavailable' | t }}';
         theme.t.regular_price = '{{ 'products.general.regular_price' | t }}';
         theme.t.sale_price = '{{ 'products.general.sale_price' | t }}';
         theme.t.qty_notice_in_stock = '{{ 'products.product.qty_notice_in_stock' | t }}';
         theme.t.qty_notice_low_stock = '{{ 'products.product.qty_notice_low_stock' | t }}';
         theme.t.qty_notice_sold_out = '{{ 'products.product.qty_notice_sold_out' | t }}';
         theme.t.qty_notice_number_in_stock_html = '{{ 'products.product.qty_notice_number_in_stock_html' | t: count: '[qty]' }}';
         theme.t.qty_notice_number_low_stock_html = '{{ 'products.product.qty_notice_number_low_stock_html' | t: count: '[qty]' }}';
         theme.t.discount_currency = '{{ 'products.product_labels.discount_currency' | t: discount_format_currency: '[discount]' }}';
         theme.t.discount_percentage = '{{ 'products.product_labels.discount_percentage' | t: discount_format_percentage: '[discount]' }}';
         theme.t.discount_text = '{{ 'products.product_labels.discount_text' | t }}';
         theme.t.unit_price_label = '{{ 'products.general.unit_price_label' | t }}';
         theme.t.unit_price_separator = '{{ 'products.general.unit_price_separator' | t }}';
      	theme.t.from_price = '{{ 'products.general.from_price' | t }}';
      	theme.t.cart_item_singular = '{{ 'cart.general.items.singular' | t }}';
      	theme.t.cart_item_plural = '{{ 'cart.general.items.plural' | t }}';
      	theme.t.sku = '{{ 'products.general.sku' | t }}';
      theme.map = {};
      theme.money_format = '{{ shop.money_format }}';
      theme.cart = {};
      theme.map_settings_url="{{ 'map_settings.min.js' | asset_url }}";
      theme.cart_type = '{{ settings.cart_type }}';
      theme.cart_ajax = {% if settings.cart_type == 'modal' or settings.cart_type == 'notification' %}true{% else %}false{% endif %};
      theme.routes = {
      	rootUrl: "{{ routes.root_url }}",
      	rootUrlSlash: "{% if routes.root_url == '/' %}{{ routes.root_url }}{% else %}{{ routes.root_url }}/{% endif %}",
      	cartUrl: "{{ routes.cart_url }}",
      	cartAddUrl: "{{ routes.cart_add_url }}",
      	cartChangeUrl: "{{ routes.cart_change_url }}"
      };
      theme.assets = {
      	plyr: "{{ 'plyr.min.js' | asset_url }}",
      	masonry: "{{ 'masonry.min.js' | asset_url }}",
      	{% comment %} photoswipe: "{{ 'photoswipe.min.js' | asset_url }}", {% endcomment %}
      	fecha: "{{ 'fecha.min.js' | asset_url }}"
      };
    </script>
    {% comment %} Device feature tests (Modernizr replacement) {% endcomment %}
    <style id="fontsupporttest">
      @font-face {
        font-family: 'font';
        src: url('https://');
      }
    </style>
    <script type="text/javascript">
      function supportsFontFace() {
        function blacklist() {
          var match = /(WebKit|windows phone.+trident)\/(\d+)/i.exec(navigator.userAgent);
          return match && parseInt(match[2], 10) < (match[1] == 'WebKit' ? 533 : 6);
        }
        function hasFontFaceSrc() {
          var style = document.getElementById('fontsupporttest');
          var sheet = style.sheet || style.styleSheet;
          var cssText = sheet
            ? sheet.cssRules && sheet.cssRules[0]
              ? sheet.cssRules[0].cssText
              : sheet.cssText || ''
            : '';
          return /src/i.test(cssText);
        }
        return !blacklist() && hasFontFaceSrc();
      }
      document.documentElement.classList.replace('no-js', 'js');
      if (window.matchMedia('(pointer: coarse)').matches) {
        document.documentElement.classList.add('touchevents');
      } else {
        document.documentElement.classList.add('no-touchevents');
      }
      if (supportsFontFace()) {
        document.documentElement.classList.add('fontface');
      }
    </script>
    <script src="{{ 'jquery.min.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'vendor.min.js' | asset_url }}" defer="defer"></script>
    {% comment %} <script src="{{ 'ajax-cart.js' | asset_url }}" defer="defer"></script> {% endcomment %}

    <!-- CSS ================================================== -->
    {% render 'css-variables' %}
    {% render 'css-include' %}

    <!-- JS after CSSOM=================================================== -->
    {% comment %} TODO: Change to importmap when properly supported {% endcomment %}
    <script type="module">
      import { produce } from "{{ 'immer.lib.js' | asset_url }}";
      import { createStore } from "{{ 'zustand-vanilla.lib.js' | asset_url }}";
      import Cookies from "{{ 'js-cookie.lib.js' | asset_url }}";

      window.theme.lib = {
        Cookies,
      };

      window.theme.cart = {
        functions: {
          produce: produce,
          createStore: createStore,
        },
      };
    </script>
    <script src="{{ 'cart-store.js' | asset_url }}" type="module"></script>
    <script src="{{ 'quantity-input.js' | asset_url }}" type="module"></script>
    <script src="{{ 'product-form.js' | asset_url }}" type="module"></script>
    <script src="{{ 'cart-link.js' | asset_url }}" type="module"></script>
    <script src="{{ 'cart-components.js' | asset_url }}" type="module"></script>
    {%- if settings.cart_free_shipping_bar_enable -%}
      {% comment %} Load lottie library if any animations are enabled {% endcomment %}
      {%- if settings.free_shipping_enable_animation_on_completion -%}
        <script src="{{ 'lottie.lib.js' | asset_url }}" defer="defer"></script>
      {%- endif -%}
      <script src="{{ 'cart-free-shipping-bar.js' | asset_url }}" type="module"></script>
    {%- endif -%}
    <script src="{{ 'product-cards.js' | asset_url }}" type="module"></script>

    <script src="{{ 'theme.min.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'custom.js' | asset_url }}" defer="defer"></script>

    {%- if settings.swatches_trigger != blank and settings.swatches_enabled -%}
      <script src="{{ 'swatch-colors.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    <script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'header-details-disclosure.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'nested-menu.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'product-interactive-options.js' | asset_url }}" type="module"></script>

    {% if request.design_mode %}
      <script id="editor-scripts" src="{{ 'editor.js' | asset_url }}" defer="defer"></script>

      <script src="{{ 'items-scroll.js' | asset_url }}" type="module"></script>
      <script src="{{ 'tabbed-content.js' | asset_url }}" type="module"></script>
      <script src="{{ 'announcement-bar.js' | asset_url }}" type="module"></script>
      <script src="{{ 'predictive-search.js' | asset_url }}" type="module"></script>
      <script src="{{ 'lazy-video.js' | asset_url }}" type="module"></script>
      <script src="{{ 'scrolling-marquee.js' | asset_url }}" type="module"></script>
      <script src="{{ 'cart-free-shipping-bar.js' | asset_url }}" type="module"></script>
      <script src="{{ 'product-single.js' | asset_url }}" type="module"></script>
      <script src="{{ 'lottie.lib.js' | asset_url }}" defer="defer"></script>
      <script src="{{ 'cart-free-shipping-bar.js' | asset_url }}" type="module"></script>
    {% endif %}

    {% if settings.anim_load %}
      <script src="{{ 'scrollreveal.min.js' | asset_url }}"></script>
    {% endif %}
    {% if template contains 'customers' %}
      <script src="{{ 'shopify_common.js' | shopify_asset_url }}"></script>
    {% endif %}

    <!-- Header hook for plugins ================================================== -->
    {% unless request.design_mode %}{% include 'wlm-head' %}{% endunless %}

    {{ content_for_header }}


    {%- if customer.metafields.sparklayer.authentication -%}
      <!-- Anything inside here only shows for logged in customers -->
      <!-- Start of SparkLayer core script -->
      <script>
        window.sparkOptions = {
          siteId: "nutritionfaktory",
          platform: "shopify",
          rootUrl: {{ routes.root_url | json }},
          language: {{ request.locale.iso_code | json }},
          accountRedirect: {
            urlRegex: /\/account/g,
            goTo: "/index", // page to redirect logged in users to
          },
          display: {
            stock: {
              show: false, // set to true to show stock level display
              max: 50, // highest stock level to show
              last: 5, // last remaining stock
              low: 15, // low stock threshold
              last: true, // set to false to hide last stock message
            },
          },
          auth: {
            user: {{ customer.email | json }},
            token: {{ customer.metafields.sparklayer.authentication | json }},
          },
        };
      </script>
      <script async src="https://sparkcdn.io/sparkjs/nutritionfaktory/live"></script>
      <!-- End of SparkLayer core script -->
      <!-- SparkLayer Sample CSS Code -->
      <style type="text/css">
        :root {
          /* Set the brand styling */
          --b2b-brand-color: #00b900; /* Main brand colour*/
          --b2b-brand-color-hover: #333; /* Main brand colour hover */
          --b2b-brand-font: Roboto, sans-serif; /* Main brand font */
          --b2b-brand-font-heading: Roboto, sans-serif; /* Main brand heading font */

          /* Update colours */
          --spark-default-body-color: #555555; /* Main body colour*/
          --spark-primary-color: #000000; /* Main title colour*/
          --spark-secondary-color: var(--b2b-brand-color); /* Main highlight colour*/
          --spark-link-color: var(--b2b-brand-color); /* Link colour*/

          /* Typefaces */
          --spark-font-default: var(--b2b-brand-font); /* Body typeface*/
          --spark-font-highlight: var(--b2b-brand-font-heading); /* Highlight typeface*/
          --spark-font-weight-default: 400; /* Default font weight*/
          --spark-font-weight-medium: 500; /* Medium font weight*/
          --spark-font-weight-heavy: 600; /* Bold font weight*/

          /* General */
          --spark-border-radius-default: 0; /* Default border radius*/
          --spark-drawer-max-width: 700px; /* Width of overlay*/
          --spark-drawer-max-width-wide: 1000px; /* Width of overlay in maximised view*/

          /* Font sizes */
          --spark-font-default-size: 14px; /* Default font size*/
          --spark-font-default-size-small: 14px; /* Default font size - small screens*/
          --spark-header-font: var(--b2b-brand-font-heading); /* Header typeface*/
          --spark-header-font-weight: 500; /* Header font weight*/
          --spark-h1-fontsize: 24px; /* Header 1 font size*/
          --spark-h2-fontsize: 22px; /* Header 2 font size*/
          --spark-h3-fontsize: 20px; /* Header 3 font size*/
          --spark-h4-fontsize: 16px; /* Header 4 font size*/
          --spark-h5-fontsize: 15px; /* Header 5 font size*/
          --spark-h6-fontsize: 14px; /* Header 6 font size*/

          --spark-pricing-fontsize: 22px; /* Font size of pricing*/
          --spark-pricing-font-weight: 500; /* Font weight of pricing*/
          --spark-pricing-fontsize-small: 14px; /* Font size of pricing on mobile*/

          --spark-product-code-fontsize: 16px; /* Font size of product code*/
          --spark-product-code-font-weight: 500; /* Font weight of product code*/
          --spark-product-code-fontsize-small: 14px; /* Font size of product code on mobile*/
          --spark-product-stockstatus-align: flex-start; /* Aligment of stock status for single variants*/

          /* Buttons */
          --spark-button-font-family: var(--b2b-brand-font-heading); /* Button typeface*/
          --spark-button-color: var(--b2b-brand-color); /* Default sutton colour*/
          --spark-button-color-highlight: var(--b2b-brand-color-hover); /* Default button colour hover*/
          --spark-button-large-color: var(--b2b-brand-color); /* Large button colour*/
          --spark-button-large-color-highlight: var(--b2b-brand-color-hover); /* Large button colour hover*/
          --spark-border-radius-button: 0; /* Button border radius*/
          --spark-button-font-weight: 600; /* Button font weight*/
          --spark-button-text-transform: none; /* Button text transform*/
          --spark-button-text-letter-spacing: 0; /* Button letter spacing*/
          --spark-button-padding: 1em 2.75em; /* Button padding*/
          --spark-button-small-font-size: 16px; /* Small button font size*/

          /* Tables */
          --spark-table-border-color: #CCCCCC; /* Table border colour*/
          --spark-table-header-background-color: #F1F1F1; /* Table header background*/
          --spark-table-header-text-color: #222222; /* Table header font colour*/
          --spark-table-header-font-weight: 500; /* Table header font weight*/

          /* Product Card */
          --spark-product-card-button-radius: 0; /* Button radius*/
          --spark-product-card-button-padding: 0.75em 1em; /* Button padding*/
          --spark-product-card-pricing-font-size: 15px; /* Pricng font size*/
          --spark-product-card-pricing-font-size-small: 14px; /* Pricng font size on mobile*/
          --spark-product-card-select-min-height: 0; /* Set a min-height for select menu*/

        }
        spark-pdp {
          display: block;
          margin: 0 0 1em
        }
        .htusb-ui-coll-boost,
        product-card-button,
        .htusb-ui-prod-boost-generic-pricing,
        .htusb-ui-coll-text,
        .product-single__box__block--inventory_notice,
        .product-single__box__block--quantity_selector,
        product-interactive-options,
        .predictive-search__item-price,
        #wonderment-pdp-eta,
        .htusb-ui-coll-boost,
        announcement-bar,
        .recharge-subscription-widget,
        .cart-count-bubble {
          display: none !Important;
          visibility: hidden !important
        }
      </style>
      <!-- End SparkLayer Sample CSS Code -->
    {%- endif -%}

 <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "onp56k73dj");
</script>
    {{ 'promi-styles.css' | asset_url | stylesheet_tag: preload: true }}
    <script>
      window.PromiConfig = {
          // Required
          moneyFormat: "{{ shop.money_format }}"
      };
      function querySelectorAllDeep(selector, root = document) {
        console.log("deep selector");
        const results = [];
        const traverse = (node) => {
          // Add matching elements
          results.push(...node.querySelectorAll(selector));
          
          // Check for shadow roots
          node.querySelectorAll('*').forEach(el => {
            if (el.shadowRoot) {
              traverse(el.shadowRoot);
            }
          });
        };
        traverse(root);
        return results;
      }

      const updatePDPPricing = (element, data) => {
        if(data.discountEnabled.productPagePriceStrikethrough && data.usecase == "product_page_large_card") {
          const priceElement = element.querySelector(".price__number").cloneNode(true);
          priceElement.classList.add("price__number--sale");
          priceElement.setAttribute("data-sezzleindex", "1");
          priceElement.querySelector(":scope > .money").innerHTML = data.salePriceCents.rendered;
          // element.querySelector(".price__number").replaceWith(priceElement);
          if(!priceElement.querySelector(".price__compare")) {
            const compareAt = document.createElement('strike');
            compareAt.classList.add("price__compare");
            compareAt.setAttribute("data-sezzleindex", "0");
            compareAt.innerHTML = `<span class="money">${ data.originalPriceCents.rendered }</span>`;
            priceElement.appendChild(compareAt);
          }
          element.querySelector(".price__number").replaceWith(priceElement);
          updateSubscription(element, data);
          
        }
      }
      const updateSubscription = (element, data) => {
        const sub = querySelectorAllDeep(".rc-selection__onetime .rc-purchase-option__prices");
        console.log("sub", sub);
        const subDup = sub[0].cloneNode(true);
        subDup.innerHTML = `
          <span class="visually-hidden">
            Original price strikethrough: 
          </span>
          <span class="rc-price strike-through text-muted" part="rc-purchase-option__original-price">
            ${ data.originalPriceCents.rendered }
          </span>
          <span class="rc-price" part="rc-purchase-option__discounted-price">
            <span class="visually-hidden">, Discounted price:</span>
            ${ data.salePriceCents.rendered }
          </span>`;
        sub[0].replaceWith(subDup);
      }
      const updateSearch = (element, data) => {
        if(data.discountEnabled.collectionPagePriceStrikethrough && data.usecase == "collection_small_card") {
          const priceElement = element.querySelector(".price__number").cloneNode(true);
          priceElement.classList.add("price__number--sale");
          priceElement.querySelector(":scope > .money").innerHTML = data.salePriceCents.rendered;
          if(!priceElement.querySelector(".price__compare")) {
            const compareAt = document.createElement('strike');
            compareAt.classList.add("price__compare");
            compareAt.innerHTML = `<span class="money">${ data.originalPriceCents.rendered }</span>`;
            priceElement.appendChild(compareAt);
          }
          element.querySelector(".price__number").replaceWith(priceElement);
        }
      }
      window.addEventListener('pm-price-update', (e) => {
        console.log('pm-price-update');
        console.log(e.detail.data);
        if (e.detail.data.price_component) {
          const pdpElements = document.querySelectorAll(`.pm-price-single.pm-event-only[data-variant-id="${e.detail.variantId}"]`);
          console.log("pdpElement", pdpElements);
          pdpElements.forEach((element) => {
            updatePDPPricing(element, e.detail.data);
          });
          const searchElements = document.querySelectorAll(`.pm-price.pm-event-only.pm-search[data-variant-id="${e.detail.variantId}"]`);
          console.log("searchElements", searchElements);
          searchElements.forEach((element) => {
            updateSearch(element, e.detail.data);
          });
        }
      });
    </script>
  </head>

  <body
    id="{{ page_title | handle }}"
    class="{% if customer %}customer-logged-in {% endif %}template-{{ template | replace: '.', ' ' | truncatewords: 1, '' | handle }}"
    data-anim-load="{{ settings.anim_load }}"
    data-anim-interval-style="{{ settings.anim_interval_style }}"
    data-anim-zoom="{{ settings.anim_zoom }}"
    data-anim-interval="{% if settings.anim_load_style == 'interval' %}true{% else %}false{% endif %}"
    data-editor-mode="{% if request.design_mode %}true{% else %}false{% endif %}"
    data-quick-shop-show-cart="{{ settings.quick_shop_show_cart }}"
    data-heading-border="{{ settings.type_header_border }}"
  >
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-NFF2NMMS"
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    {%- if request.design_mode -%}
      {% comment %} Check if the document is used for visual preview {% endcomment %}
      <script type="text/javascript">
        if (document.location.href.includes('shopifyInternalAddSectionPicker=true')) {
          document.body.setAttribute('data-anim-load', 'false');
        }
      </script>
    {%- endif -%}
    <script type="text/javascript">
      //loading class for animations
      document.body.className += ' ' + 'js-theme-loading';
      setTimeout(function () {
        document.body.className = document.body.className.replace('js-theme-loading', 'js-theme-loaded');
      }, 300);
    </script>

    {% comment %} TODO: optimize loading templates {% endcomment %}
    <script type="application/json" id="cart-data">
      {{ cart | json }}
    </script>
    {%- if settings.cart_gift_wrapping_product.variants.first.inventory_management == null
      and settings.cart_gift_wrapping_product != blank
    -%}
      <script type="application/json" id="cart-gift-wrapping-data">
        {
        	"productId": {{ settings.cart_gift_wrapping_product.variants.first.id }},
        	"wrapIndividually": {{ settings.cart_gift_wrapping_individual }}
        }
      </script>
    {%- endif -%}
    {% render 'cart-templates' %}

    <a class="skip-to-content-link" href="#main">{{ 'accessibility.skip_to_text' | t }}</a>

    <div class="page-transition"></div>

    <div class="page-container">
      {% render 'header-scripts' %}
      {% sections 'header-group' %}

      {% sections 'popup-group' %}

      <div class="main" id="main">
        {% comment %}{{ content_for_layout }}{% endcomment %}
        {%- include 'wlm-body' %}
      </div>

      {% sections 'footer-group' %}
    </div>

    {% if settings.search_enable %}
      {% render 'search-drawer' %}
    {% endif %}

    {%- if settings.cart_type != 'page' -%}
      {%- liquid
        if settings.cart_type == 'modal'
          assign modal_class = 'cart-draw'
          assign additoinal_classes = 'mobile-draw cart-draw--' | append: settings.color_drawer_style
        else
          assign modal_class = 'cart-notification'
        endif
      -%}
      {%- unless request.page_type == 'cart' and settings.cart_type == 'modal' -%}
        <div class="js-cart-draw mfp-hide {{ modal_class }} {{ additoinal_classes }}">
          <div class="{{ modal_class }}__wrapper">
            {%- liquid
              if settings.cart_type == 'modal'
                include 'cart-drawer'
              endif
            -%}

            {%- if settings.cart_type == 'notification' -%}
              {%- render 'cart-notification' -%}
            {%- endif -%}
          </div>
        </div>
      {%- endunless -%}
    {%- endif -%}

    {% unless request.design_mode %}
      <script>
        const announcementBars = document.querySelectorAll('announcement-bar');

        if (announcementBars.length > 0) {
          announcementBars.forEach((announcementBar) => {
            const sectionId = announcementBar.getAttribute('id');
            const sessionStorageValue = sessionStorage.getItem(sectionId);

            if (sessionStorageValue === '0') {
              announcementBar.setAttribute('hidden', 'hidden');
            }
          });
        }
      </script>
    {% endunless %}

    <!-- Venue theme by Safe As Milk - http://safeasmilk.co/ -->
    <!-- Theme version 11.0.3 -->
    <script src="https://a.klaviyo.com/media/js/onsite/onsite.js"></script>
    <script>
        var klaviyo = klaviyo || [];
        klaviyo.init({
          account: "QsYVVi",
          platform: "shopify"
        });
        klaviyo.enable("backinstock",{
        trigger: {
          product_page_text: "Notify Me When Available",
          product_page_class: "btn",
          product_page_text_align: "center",
          product_page_margin: "0px",
          replace_anchor: true
        },
        modal: {
         headline: "{product_name}",
         body_content: "Register to receive a notification when this item comes back in stock.",
         email_field_label: "Email",
         button_label: "Notify me when available",
         subscription_success_label: "You're in! We'll let you know when it's back.",
         footer_content: '',
         additional_styles: ".klaviyo-bis-modal .modal-title, .klaviyo-bis-modal p{ font-family: 'Century-Gothic' } .klaviyo-bis-modal .btn-succes{ background-color: #00b900; border-radius: 6px; font-family: 'Centiry-Gothic' }",
         drop_background_color: "#000",
         background_color: "#fff",
         text_color: "#222",
         button_text_color: "#fff",
         button_background_color: "#00b900",
         close_button_color: "#ccc",
         error_background_color: "#fcd6d7",
         error_text_color: "#C72E2F",
         success_background_color: "#d3efcd",
         success_text_color: "#1B9500"
        }
      });
    </script>

  </body>
</html>
